{{ define "main" }}
  {{ partial "page-header" . }}


  <section class="section-sm">
    <div class="container">
      <div class="row">
        <div class="md:col-10 lg:col-8 mx-auto">
          <div class="mb-8 text-center">
            <p class="text-lg text-text dark:text-darkmode-text">
              {{ .Content }}
            </p>
          </div>

          <!-- Success Message (hidden by default) -->
          <div
            id="success-message"
            class="hidden bg-primary/10 border-2 border-primary rounded-lg p-8 text-center mb-8">
            <div class="text-6xl mb-4">✓</div>
            <h3 class="text-2xl font-bold text-primary mb-4">
              Thank You for Reaching Out!
            </h3>
            <p class="text-lg text-text dark:text-darkmode-text mb-2">
              I've received your message and will get back to you as soon as
              possible.
            </p>
            <p class="text-text-light dark:text-darkmode-text-light">
              Usually within 24-48 hours during business days.
            </p>
          </div>

          <!-- Error Message (hidden by default) -->
          <div
            id="error-message"
            class="hidden bg-red-500/10 border-2 border-red-500 rounded-lg p-8 text-center mb-8">
            <div class="text-6xl mb-4">✗</div>
            <h3 class="text-2xl font-bold text-red-500 mb-4">
              Oops! Something went wrong
            </h3>
            <p class="text-lg text-text dark:text-darkmode-text mb-2">
              Please try again or contact me directly via email.
            </p>
          </div>

          <!-- Contact Form -->
          <form
            id="contact-form"
            action="{{ site.Params.contact_form_action }}"
            method="POST"
            novalidate
            class="bg-light dark:bg-darkmode-light rounded-lg p-8">
            <div class="mb-6">
              <label for="name" class="form-label">
                Full Name <span class="text-red-500">*</span>
              </label>
              <input
                id="name"
                name="name"
                class="form-input"
                placeholder="John Doe"
                type="text"
                required />
              <span
                id="name-error"
                class="text-red-500 text-sm mt-1 hidden"></span>
            </div>

            <div class="mb-6">
              <label for="email" class="form-label">
                Email Address <span class="text-red-500">*</span>
              </label>
              <input
                id="email"
                name="email"
                class="form-input"
                placeholder="john.doe@email.com"
                type="email"
                required />
              <span
                id="email-error"
                class="text-red-500 text-sm mt-1 hidden"></span>
            </div>

            <div class="mb-6">
              <label for="company" class="form-label">
                Company / Organization
              </label>
              <input
                id="company"
                name="company"
                class="form-input"
                placeholder="Acme Inc."
                type="text" />
            </div>

            <div class="mb-6">
              <label for="inquiry_type" class="form-label">
                Type of Inquiry <span class="text-red-500">*</span>
              </label>
              <select
                id="inquiry_type"
                name="inquiry_type"
                class="form-input"
                required>
                <option value="">Select an option</option>
                <option value="job_opportunity">Job Opportunity</option>
                <option value="consulting">
                  Consulting / Freelance Project
                </option>
                <option value="collaboration">
                  Collaboration / Partnership
                </option>
                <option value="speaking">Speaking / Workshop</option>
                <option value="mentorship">Mentorship Request</option>
                <option value="other">Other</option>
              </select>
              <span
                id="inquiry_type-error"
                class="text-red-500 text-sm mt-1 hidden"></span>
            </div>

            <div class="mb-6">
              <label for="subject" class="form-label">
                Subject <span class="text-red-500">*</span>
              </label>
              <input
                id="subject"
                name="subject"
                class="form-input"
                placeholder="Brief subject line"
                type="text"
                required />
              <span
                id="subject-error"
                class="text-red-500 text-sm mt-1 hidden"></span>
            </div>

            <div class="mb-6">
              <label for="message" class="form-label">
                Message <span class="text-red-500">*</span>
              </label>
              <textarea
                id="message"
                name="message"
                class="form-input"
                placeholder="Tell me more about your inquiry, project details, timeline, budget (if applicable), or any specific requirements..."
                rows="8"
                required></textarea>
              <span
                id="message-error"
                class="text-red-500 text-sm mt-1 hidden"></span>
            </div>

            <div class="mb-6">
              <label for="timeline" class="form-label">
                Expected Timeline / Start Date
              </label>
              <input
                id="timeline"
                name="timeline"
                class="form-input"
                placeholder="e.g., Immediate, Within 2 weeks, Next month"
                type="text" />
            </div>

            <button
              type="submit"
              id="submit-btn"
              class="btn btn-primary w-full">
              <span id="submit-text" style="display: inline;"
                >Send Message</span
              >
              <span id="submit-loading" style="display: none;">Sending...</span>
              <i
                id="submit-icon"
                style="display: inline;"
                class="fa fa-paper-plane pl-2"></i>
              <i
                id="loading-icon"
                style="display: none;"
                class="fa fa-spinner fa-spin pl-2"></i>
            </button>
          </form>

          <div
            class="mt-8 text-center text-sm text-text-light dark:text-darkmode-text-light">
            <p>You can also reach me directly at:</p>
            <div class="mt-4 flex flex-wrap justify-center gap-4">
              <a
                href="mailto:deepakvbansode@gmail.com"
                class="inline-flex items-center text-primary hover:underline">
                <i class="fa fa-envelope mr-2"></i>
                deepakvbansode@gmail.com
              </a>
              <a
                href="https://www.linkedin.com/in/deepak-bansode-506a25120/"
                target="_blank"
                rel="noopener"
                class="inline-flex items-center text-primary hover:underline">
                <i class="fab fa-linkedin mr-2"></i>
                LinkedIn Profile
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    // AJAX Form Submission
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("contact-form");
      const submitBtn = document.getElementById("submit-btn");
      const submitText = document.getElementById("submit-text");
      const submitLoading = document.getElementById("submit-loading");
      const submitIcon = document.getElementById("submit-icon");
      const loadingIcon = document.getElementById("loading-icon");
      const successMessage = document.getElementById("success-message");
      const errorMessage = document.getElementById("error-message");

      // Safety check - ensure all elements exist
      if (
        !form ||
        !submitBtn ||
        !submitText ||
        !submitLoading ||
        !submitIcon ||
        !loadingIcon
      ) {
        console.error("Form elements not found");
        return;
      }

      // Function to reset button state using inline styles
      function resetButtonState() {
        if (submitBtn) submitBtn.disabled = false;
        if (submitText) {
          submitText.style.display = "inline";
          submitText.classList.remove("hidden");
        }
        if (submitLoading) {
          submitLoading.style.display = "none";
          submitLoading.classList.add("hidden");
        }
        if (submitIcon) {
          submitIcon.style.display = "inline";
          submitIcon.classList.remove("hidden");
        }
        if (loadingIcon) {
          loadingIcon.style.display = "none";
          loadingIcon.classList.add("hidden");
        }
      }

      // Clear any stale session storage on page load
      sessionStorage.removeItem("formSubmitted");

      // Always ensure button is in normal state on page load
      resetButtonState();

      // Check on page load if form was submitted (using sessionStorage)
      const formSubmitted = sessionStorage.getItem("formSubmitted");
      if (formSubmitted === "true") {
        if (form) form.style.display = "none";
        if (successMessage) successMessage.classList.remove("hidden");
        sessionStorage.removeItem("formSubmitted");
      }

      // Custom validation functions
      function showError(fieldId, message) {
        const errorElement = document.getElementById(fieldId + "-error");
        const inputElement = document.getElementById(fieldId);
        if (errorElement) {
          errorElement.textContent = message;
          errorElement.classList.remove("hidden");
        }
        if (inputElement) {
          inputElement.classList.add("border-red-500");
        }
      }

      function clearError(fieldId) {
        const errorElement = document.getElementById(fieldId + "-error");
        const inputElement = document.getElementById(fieldId);
        if (errorElement) {
          errorElement.textContent = "";
          errorElement.classList.add("hidden");
        }
        if (inputElement) {
          inputElement.classList.remove("border-red-500");
        }
      }

      function validateField(fieldId) {
        const field = document.getElementById(fieldId);
        if (!field) return true;

        const value = field.value.trim();

        switch (fieldId) {
          case "name":
            if (!value) {
              showError("name", "Please enter your full name");
              return false;
            } else if (value.length < 2) {
              showError("name", "Name must be at least 2 characters long");
              return false;
            }
            break;

          case "email":
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!value) {
              showError("email", "Please enter your email address");
              return false;
            } else if (!emailRegex.test(value)) {
              showError("email", "Please enter a valid email address");
              return false;
            }
            break;

          case "inquiry_type":
            if (!field.value) {
              showError("inquiry_type", "Please select an inquiry type");
              return false;
            }
            break;

          case "subject":
            if (!value) {
              showError("subject", "Please enter a subject");
              return false;
            } else if (value.length < 5) {
              showError(
                "subject",
                "Subject must be at least 5 characters long",
              );
              return false;
            }
            break;

          case "message":
            if (!value) {
              showError("message", "Please enter your message");
              return false;
            } else if (value.length < 20) {
              showError(
                "message",
                "Message must be at least 20 characters long",
              );
              return false;
            }
            break;
        }

        clearError(fieldId);
        return true;
      }

      function validateForm() {
        let isValid = true;

        // Clear all previous errors
        ["name", "email", "inquiry_type", "subject", "message"].forEach(
          clearError,
        );

        // Validate name
        const name = document.getElementById("name").value.trim();
        if (!name) {
          showError("name", "Please enter your full name");
          isValid = false;
        } else if (name.length < 2) {
          showError("name", "Name must be at least 2 characters long");
          isValid = false;
        }

        // Validate email
        const email = document.getElementById("email").value.trim();
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email) {
          showError("email", "Please enter your email address");
          isValid = false;
        } else if (!emailRegex.test(email)) {
          showError("email", "Please enter a valid email address");
          isValid = false;
        }

        // Validate inquiry type
        const inquiryType = document.getElementById("inquiry_type").value;
        if (!inquiryType) {
          showError("inquiry_type", "Please select an inquiry type");
          isValid = false;
        }

        // Validate subject
        const subject = document.getElementById("subject").value.trim();
        if (!subject) {
          showError("subject", "Please enter a subject");
          isValid = false;
        } else if (subject.length < 5) {
          showError("subject", "Subject must be at least 5 characters long");
          isValid = false;
        }

        // Validate message
        const message = document.getElementById("message").value.trim();
        if (!message) {
          showError("message", "Please enter your message");
          isValid = false;
        } else if (message.length < 20) {
          showError("message", "Message must be at least 20 characters long");
          isValid = false;
        }

        return isValid;
      }

      // Add real-time validation on blur
      ["name", "email", "inquiry_type", "subject", "message"].forEach(
        (fieldId) => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.addEventListener("blur", function () {
              validateField(fieldId);
            });
            field.addEventListener("input", function () {
              clearError(fieldId);
            });
          }
        },
      );

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        // Validate form before submission
        if (!validateForm()) {
          return;
        }

        // Disable button and show loading state
        submitBtn.disabled = true;
        submitText.style.display = "none";
        submitText.classList.add("hidden");
        submitLoading.style.display = "inline";
        submitLoading.classList.remove("hidden");
        submitIcon.style.display = "none";
        submitIcon.classList.add("hidden");
        loadingIcon.style.display = "inline";
        loadingIcon.classList.remove("hidden");

        // Get form data
        const formData = new FormData(form);

        try {
          // Submit to Formspree
          const response = await fetch(form.action, {
            method: "POST",
            body: formData,
            headers: {
              Accept: "application/json",
            },
          });

          if (response.ok) {
            // Success - mark as submitted and hide form
            sessionStorage.setItem("formSubmitted", "true");
            form.style.display = "none";
            successMessage.classList.remove("hidden");
            successMessage.scrollIntoView({
              behavior: "smooth",
              block: "center",
            });

            // Reset form
            form.reset();

            // Reset button state
            resetButtonState();
          } else {
            // Error - show error message
            errorMessage.classList.remove("hidden");
            errorMessage.scrollIntoView({
              behavior: "smooth",
              block: "center",
            });

            // Reset button state
            resetButtonState();

            // Hide error message after 5 seconds
            setTimeout(() => {
              errorMessage.classList.add("hidden");
            }, 5000);
          }
        } catch (error) {
          // Network error - show error message
          errorMessage.classList.remove("hidden");
          errorMessage.scrollIntoView({ behavior: "smooth", block: "center" });

          // Reset button state
          resetButtonState();

          // Hide error message after 5 seconds
          setTimeout(() => {
            errorMessage.classList.add("hidden");
          }, 5000);
        }
      });
    });
  </script>
{{ end }}
